#=====================================================
# COSTRUIRE LA RETE DEL LETTO
#=====================================================
# G29 che fa (1) tutto a casa (2) ottiene la rete del letto (3) sposta 
# l'ugello nell'angolo in modo che non trasudi sul letto durante il riscaldamento.




###############################################################################################################################################
# La macro CLEAN_PURGE è un comando G-code che esegue una pulizia dell'ugello della stampante 3D e include una fase di purga, cioè un'estrusione
#forzata di filamento per rimuovere eventuali residui dall'interno dell'ugello. Di seguito è spiegato come funziona il comando e come utilizzarlo.
###############################################################################################################################################


[gcode_macro CLEAN_PURGE]
Description: Pulizia dell'ugello che include una fase di purga, cioè un'estrusione forzata di 100mm del filamento per rimuovere eventuali residui dall'interno dell'ugello. 
gcode:
    SAVE_GCODE_STATE NAME=STATE_CLEAN ; Salva lo stato corrente della stampante, inclusa la posizione degli assi, le temperature e altre variabili, così da poterle ripristinare dopo la pulizia.
    SET_GCODE_OFFSET Z=0.0  ;Resetta l'offset dell'asse Z a zero, per garantire che il movimento durante la pulizia non sia influenzato da eventuali modifiche precedenti all'offset Z.
    SET_GCODE_VARIABLE MACRO=clean_nozzle  VARIABLE=wipe_qty VALUE=5 ;Imposta la quantità di passaggi di pulizia (wipes) a 5. Durante questi passaggi, l'ugello verrà pulito su una superficie dedicata.
    SET_GCODE_VARIABLE MACRO=clean_nozzle  VARIABLE=enable_purge VALUE=True ; Abilita la purga del filamento. Questo significa che durante la pulizia, verrà estruso filamento per eliminare eventuali residui interni all'ugello.
    SET_GCODE_VARIABLE MACRO=clean_nozzle  VARIABLE=purge_len VALUE=100 ;Imposta la lunghezza della purga del filamento a 100 mm. 
    #Questo significa che verrà estruso un breve tratto di filamento, sufficiente per preparare l'ugello senza sprecare troppo materiale.
    CLEAN_NOZZLE ; Avvia la procedura di pulizia e purga dell'ugello utilizzando le impostazioni precedentemente definite.
    RESTORE_GCODE_STATE NAME=STATE_CLEAN ;  Ripristina lo stato della stampante al termine della pulizia, riportando la macchina alle condizioni in cui si trovava prima di eseguire il comando.

###############################################################################################################################################
# La macro CLEAN_PRIME è progettata per eseguire una rapida pulizia e preparazione dell'ugello della stampante 3D, con l'aggiunta di una piccola
#purga (priming) del filamento per garantire che l'ugello sia pronto per la stampa. Ecco una descrizione dettagliata e come utilizzare questo comando.
###############################################################################################################################################

[gcode_macro CLEAN_PRIME]
Description: Pulizia dell'ugello che include una fase di purga, cioè un'estrusione forzata di 25mm del filamento per rimuovere eventuali residui dall'interno dell'ugello. 
gcode:
    SAVE_GCODE_STATE NAME=STATE_CLEAN ; Salva lo stato corrente della stampante, inclusa la posizione degli assi, le temperature e altre variabili, così da poterle ripristinare dopo la pulizia.
    SET_GCODE_OFFSET Z=0.0   ;Resetta l'offset dell'asse Z a zero, per garantire che il movimento durante la pulizia non sia influenzato da eventuali modifiche precedenti all'offset Z.
    SET_GCODE_VARIABLE MACRO=clean_nozzle  VARIABLE=wipe_qty VALUE=5 ;Imposta la quantità di passaggi di pulizia (wipes) a 5. Durante questi passaggi, l'ugello verrà pulito su una superficie dedicata.
    SET_GCODE_VARIABLE MACRO=clean_nozzle  VARIABLE=enable_purge VALUE=True ;Abilita la purga del filamento. Questo significa che durante la pulizia, verrà estruso filamento per eliminare eventuali residui interni all'ugello.
    SET_GCODE_VARIABLE MACRO=clean_nozzle  VARIABLE=purge_len VALUE=25 ;Imposta la lunghezza della purga del filamento a 25 mm. 
    #Questo significa che verrà estruso un breve tratto di filamento, sufficiente per preparare l'ugello senza sprecare troppo materiale.
    CLEAN_NOZZLE  ; Avvia la procedura di pulizia e purga dell'ugello utilizzando le impostazioni precedentemente definite.
    RESTORE_GCODE_STATE NAME=STATE_CLEAN ;  Ripristina lo stato della stampante al termine della pulizia, riportando la macchina alle condizioni in cui si trovava prima di eseguire il comando.

###############################################################################################################################################
#macro CLEAN_NOPURGE è un comando G-code che esegue una pulizia dell'ugello della stampante 3D senza effettuare la purga del filamento. 
# Questo comando è utile per rimuovere eventuali residui esterni dall'ugello senza sprecare filamento tramite estrusione.
###############################################################################################################################################

[gcode_macro CLEAN_NOPURGE]
Description: Pulizia dell'ugello senza un'estrusione del filamento.
gcode:
    SAVE_GCODE_STATE NAME=STATE_CLEAN ; Salva lo stato corrente della stampante, inclusa la posizione degli assi, le temperature e altre variabili, così da poterle ripristinare dopo la pulizia.
    SET_GCODE_OFFSET Z=0.0   ;Resetta l'offset dell'asse Z a zero, per garantire che il movimento durante la pulizia non sia influenzato da eventuali modifiche precedenti all'offset Z.
    SET_GCODE_VARIABLE MACRO=clean_nozzle  VARIABLE=wipe_qty VALUE=3 ;Imposta la quantità di passaggi di pulizia (wipes) a 5. Durante questi passaggi, l'ugello verrà pulito su una superficie dedicata.
    SET_GCODE_VARIABLE MACRO=clean_nozzle  VARIABLE=enable_purge VALUE=False ; Disabilita la purga del filamento durante la pulizia, evitando l'estrusione di materiale.
    CLEAN_NOZZLE  ; Avvia la procedura di pulizia dell'ugello utilizzando i parametri definiti (3 passaggi di pulizia, senza purga).
    RESTORE_GCODE_STATE NAME=STATE_CLEAN ; Ripristina lo stato della stampante al termine della pulizia, riportando la macchina alle condizioni originali.





    